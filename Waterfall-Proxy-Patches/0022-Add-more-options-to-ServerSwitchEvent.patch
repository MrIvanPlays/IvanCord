From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: MrIvanPlays <pekov.ivan@abv.bg>
Date: Sun, 21 Jul 2019 10:17:29 +0300
Subject: [PATCH] Add more options to ServerSwitchEvent


diff --git a/api/src/main/java/net/md_5/bungee/api/event/ServerSwitchEvent.java b/api/src/main/java/net/md_5/bungee/api/event/ServerSwitchEvent.java
index 4722517aed4f34a214516ebbd3350e1adc1dc4b1..db9d219a655052d8a3197c87b980ab237fc9ec0f 100644
--- a/api/src/main/java/net/md_5/bungee/api/event/ServerSwitchEvent.java
+++ b/api/src/main/java/net/md_5/bungee/api/event/ServerSwitchEvent.java
@@ -3,6 +3,7 @@ package net.md_5.bungee.api.event;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;
+import net.md_5.bungee.api.config.ServerInfo; // IvanCord
 import net.md_5.bungee.api.connection.ProxiedPlayer;
 import net.md_5.bungee.api.plugin.Event;
 
@@ -19,4 +20,14 @@ public class ServerSwitchEvent extends Event
      * Player whom the server is for.
      */
     private final ProxiedPlayer player;
+
+    // IvanCord start - more options
+
+    /**
+     * The server, where the player switched from.
+     *
+     * This may return null if the connection is initial
+     */
+    private final ServerInfo oldServer;
+    // IvanCord end
 }
diff --git a/proxy/src/main/java/net/md_5/bungee/ServerConnector.java b/proxy/src/main/java/net/md_5/bungee/ServerConnector.java
index d446f1cf8260efa1ef3dca171760353aa39a7be2..e32204e16d3b3ededd452a1e496df908e22d4ca1 100644
--- a/proxy/src/main/java/net/md_5/bungee/ServerConnector.java
+++ b/proxy/src/main/java/net/md_5/bungee/ServerConnector.java
@@ -363,10 +363,12 @@ public class ServerConnector extends PacketHandler
         user.setServerJoinQueue( null );
         user.setDimensionChange( false );
 
+        ServerInfo old = user.getServer() != null ? user.getServer().getInfo() : null; // IvanCord - add more options to ServerSwitchEvent
+
         user.setServer( server );
         ch.getHandle().pipeline().get( HandlerBoss.class ).setHandler( new DownstreamBridge( bungee, user, server ) );
 
-        bungee.getPluginManager().callEvent( new ServerSwitchEvent( user ) );
+        bungee.getPluginManager().callEvent( new ServerSwitchEvent( user, old ) ); // IvanCord
 
         thisState = State.FINISHED;
 
