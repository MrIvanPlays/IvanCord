From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: MrIvanPlays <ivan@mrivanplays.com>
Date: Sun, 14 Jun 2020 14:11:26 +0300
Subject: [PATCH] Optimize Varint21FrameDecoder


diff --git a/protocol/src/main/java/net/md_5/bungee/protocol/Varint21FrameDecoder.java b/protocol/src/main/java/net/md_5/bungee/protocol/Varint21FrameDecoder.java
index 743d65e43549f4db3b1f6785a69ab69e19004285..b8aa41afc195fac3c72148097efc5c561d242b5b 100644
--- a/protocol/src/main/java/net/md_5/bungee/protocol/Varint21FrameDecoder.java
+++ b/protocol/src/main/java/net/md_5/bungee/protocol/Varint21FrameDecoder.java
@@ -15,6 +15,13 @@ public class Varint21FrameDecoder extends ByteToMessageDecoder
     @Override
     protected void decode(ChannelHandlerContext ctx, ByteBuf in, List<Object> out) throws Exception
     {
+        // IvanCord start
+        if ( !ctx.channel().isActive() )
+        {
+            in.skipBytes( in.readableBytes() );
+            return;
+        }
+        // IvanCord end
         in.markReaderIndex();
 
         for ( int i = 0; i < 3; i++ ) // Waterfall
