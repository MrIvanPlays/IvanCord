From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Janmm14 <gitconfig1@janmm14.de>
Date: Fri, 19 Nov 2021 08:23:47 +0200
Subject: [PATCH] Add time measurement per event listener method

Results in more useful warnings as listener class is mentioned

diff --git a/event/src/main/java/net/md_5/bungee/event/EventBus.java b/event/src/main/java/net/md_5/bungee/event/EventBus.java
index b2d8efee343a4be1de58b8e6edfb8c1c507776b1..043799bc9a84c84ee2711703f38a0148b794bbaa 100644
--- a/event/src/main/java/net/md_5/bungee/event/EventBus.java
+++ b/event/src/main/java/net/md_5/bungee/event/EventBus.java
@@ -43,6 +43,7 @@ public class EventBus
         {
             for ( EventHandlerMethod method : handlers )
             {
+                long start = System.currentTimeMillis(); // IvanCord
                 try
                 {
                     method.invoke( event );
@@ -69,6 +70,15 @@ public class EventBus
                         exceptionHandler.handleEventException( msg, event, method, error );
                     }
                 }
+
+                long elapsed = System.currentTimeMillis() - start;
+                if ( elapsed > 200 )
+                {
+                    logger.log( Level.WARNING, "Plugin listener {0} took {1}ms to process event {2}!", new Object[]
+                    {
+                            method.getListener().getClass().getName(), elapsed, event
+                    } );
+                }
                 // IvanCord end
             }
         }
